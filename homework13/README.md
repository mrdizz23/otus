>Сформировал с помощью процедурной функции представленную на предыдущем занятии таблицу **`products`** из 10000 записей, на основе которой и буду проводить работу

```
mysql> CREATE TABLE products (
    ->     id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    ->     title VARCHAR(32) NOT NULL,
    ->     category VARCHAR(32) NOT NULL,
    ->     price INT NOT NULL,
    ->     rating INT,
    ->     status VARCHAR(32) NOT NULL
    -> );
Query OK, 0 rows affected (0.02 sec)
```
```
mysql> CALL PopulateProducts(10000, 'Напитки,Консервы,Орехи,Овощи,Мясо,Колбасы,Бакалея');
Query OK, 1 row affected (4.67 sec)
```
```
mysql> SELECT *
    ->   FROM products
    ->   LIMIT 10;
+----+---------------+------------------+-------+--------+--------------------+
| id | title         | category         | price | rating | status             |
+----+---------------+------------------+-------+--------+--------------------+
|  1 | Товар #0      | Консервы         |   520 |      1 | В наличии          |
|  2 | Товар #1      | Консервы         |   594 |      4 | Распродан          |
|  3 | Товар #2      | Консервы         |   813 |      3 | В наличии          |
|  4 | Товар #3      | Мясо             |   692 |      2 | В наличии          |
|  5 | Товар #4      | Консервы         |   595 |      2 | Распродан          |
|  6 | Товар #5      | Колбасы          |   171 |      2 | Распродан          |
|  7 | Товар #6      | Орехи            |   931 |      5 | Распродан          |
|  8 | Товар #7      | Колбасы          |   166 |      3 | В наличии          |
|  9 | Товар #8      | Колбасы          |   641 |      4 | В наличии          |
| 10 | Товар #9      | Овощи            |    51 |      4 | Распродан          |
+----+---------------+------------------+-------+--------+--------------------+
10 rows in set (0.00 sec)

mysql> select count(*) from products;
+----------+
| count(*) |
+----------+
|    10000 |
+----------+
1 row in set (0.01 sec)

```

### 1. группировки с ипользованием CASE, HAVING, ROLLUP, GROUPING()

Сформировать отчет по **распроданным** товарам - количество по категриям и общую стоймость. В конце посчитать сводную сумму по всем в строке ИТОГО

```
mysql> SELECT
    ->     IF(GROUPING(category), 'ИТОГО', category) as category,
    ->     SUM(price) as sum_price,
    ->     SUM( CASE WHEN status = 'Распродан'
    ->          THEN 1
    ->          ELSE 0
    ->          END ) as count
    ->     FROM products
    ->     GROUP BY category
    ->     WITH ROLLUP;
+------------------+-----------+-------+
| category         | sum_price | count |
+------------------+-----------+-------+
| Бакалея          |    396889 |   383 |
| Колбасы          |    813216 |   836 |
| Консервы         |    873165 |   836 |
| Мясо             |    810389 |   813 |
| Напитки          |    439600 |   441 |
| Овощи            |    823747 |   820 |
| Орехи            |    856999 |   862 |
| ИТОГО            |   5014005 |  4991 |
+------------------+-----------+-------+
8 rows in set, 1 warning (0.02 sec)
```

### 2. Добавить максимальную и минимальную цену и кол-во предложений
 
```
mysql> SELECT
    ->     category,
    ->     SUM(price) as sum_price,
    ->     MAX(price) as max_price,
    ->     MIN(price) as min_price,
    ->     SUM( CASE WHEN status = 'Распродан'
    ->          THEN 1
    ->          ELSE 0
    ->          END ) as count
    ->     FROM products
    ->     GROUP BY category;
+------------------+-----------+-----------+-----------+-------+
| category         | sum_price | max_price | min_price | count |
+------------------+-----------+-----------+-----------+-------+
| Консервы         |    873165 |       999 |        10 |   836 |
| Мясо             |    810389 |       999 |        11 |   813 |
| Колбасы          |    813216 |       998 |        10 |   836 |
| Орехи            |    856999 |       999 |        10 |   862 |
| Овощи            |    823747 |       998 |        10 |   820 |
| Бакалея          |    396889 |       998 |        10 |   383 |
| Напитки          |    439600 |       999 |        14 |   441 |
+------------------+-----------+-----------+-----------+-------+
7 rows in set (0.01 sec)
```

### 3. Cделать выборку, показывающую самый дорогой и самый дешевый товар в каждой категории

>Добавил для наглядности товары с ценой, выходящие из начального диапазона, заложенного в функции

#### Дорогие товары
```
mysql> SELECT
    ->     t_max.title,
    ->     p.category,
    ->     p.max_price
    -> FROM (
    ->     SELECT
    ->         category,
    ->         MAX(price) AS max_price
    ->     FROM
    ->         products
    ->     GROUP BY
    ->         category
    -> ) p
    -> JOIN products t_max ON p.category = t_max.category AND p.max_price = t_max.price
    -> ;
+------------------+------------------+-----------+
| title            | category         | max_price |
+------------------+------------------+-----------+
| Товар #2620      | Консервы         |       999 |
| Товар #3299      | Колбасы          |       998 |
| Товар #4859      | Напитки          |       999 |
| Товар #5099      | Орехи            |       999 |
| Товар #7         | Овощи            |      1261 |
| Товар #8         | Мясо             |      1226 |
| Товар #9         | Бакалея          |      1948 |
+------------------+------------------+-----------+
7 rows in set (0.02 sec)
```

#### Дешевые товары
```mysql> SELECT
    ->     t_min.title,
    ->     p.category,
    ->     p.min_price
    -> FROM (
    ->     SELECT
    ->         category,
    ->         min(price) AS min_price
    ->     FROM
    ->         products
    ->     GROUP BY
    ->         category
    -> ) p
    -> JOIN products t_min ON p.category = t_min.category AND p.min_price = t_min.price
    -> ;
+------------------+------------------+-----------+
| title            | category         | min_price |
+------------------+------------------+-----------+
| Товар #2105      | Колбасы          |         2 |
| Товар #2153      | Орехи            |         7 |
| Товар #7478      | Бакалея          |        10 |
| Товар #7540      | Консервы         |        10 |
| Товар #8101      | Напитки          |        14 |
| Товар #8301      | Мясо             |        11 |
| Товар #8749      | Овощи            |        10 |
+------------------+------------------+-----------+
7 rows in set (0.02 sec)
```

### 4. Cделать rollup с количеством товаров по категориям


```
mysql> SELECT
    ->     IF(GROUPING(category), 'ИТОГО', category)
    ->         AS category,
    ->     COUNT(*) AS total
    ->     FROM products
    ->     GROUP BY category
    ->     WITH ROLLUP;
+------------------+-------+
| category         | total |
+------------------+-------+
| Бакалея          |   820 |
| Колбасы          |  1635 |
| Консервы         |  1735 |
| Мясо             |  1633 |
| Напитки          |   872 |
| Овощи            |  1612 |
| Орехи            |  1703 |
| ИТОГО            | 10010 |
+------------------+-------+
8 rows in set, 1 warning (0.01 sec)

mysql> select count(*) from products;
+----------+
| count(*) |
+----------+
|    10010 |
+----------+
1 row in set (0.01 sec)
```